workflows:
  ios_app_store:
    name: iOS App Store Build
    environment:
      vars:
        GOOGLE_SERVICE_INFO: Encrypted_base64_content_of_GoogleService-Info.plist
      flutter: stable
      xcode: latest # أو يمكنك تحديد إصدار معين من Xcode يدعم iOS 13.0 أو أعلى
    scripts:
      - name: Decode GoogleService-Info.plist
        script: |
          echo $GOOGLE_SERVICE_INFO | base64 --decode > ios/Runner/GoogleService-Info.plist
      - name: Install Flutter dependencies
        script: |
          flutter pub get
      - name: Set iOS platform to 13.0
        script: |
          sed -i '' 's/platform :ios, '[0-9.]*/platform :ios, '13.0'/' ios/Podfile
      - name: Install CocoaPods
        script: |
          cd ios
          pod install
      - name: Build iOS for App Store
        script: |
          flutter build ios --release --no-codesign

    artifacts:
      - build/ios/ipa/*.ipa

    publishing:
      app_store_connect:
        apple_id: salehalkhaier@icloud.com
        api_key_id: 27SYY7JZ63
        api_issuer_id: 69a6de90-fe9b-47e3-e053-5b8c7c11a4d1
